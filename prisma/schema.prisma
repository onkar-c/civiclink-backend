generator client {
  provider = "prisma-client-js"

}

datasource db {
  provider = "postgresql"
  // IMPORTANT: no `url` here in Prisma 7
}
// ----- Initial CivicLink schema (MVP) -----

model User {
  id           String      @id @default(uuid())
  name         String
  email        String      @unique
  passwordHash String
  role         UserRole    @default(CITIZEN)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  issuesCreated Issue[]
  issueEvents   IssueEvent[] @relation("UserIssueEvents")
}

model Issue {
  id              String        @id @default(uuid())
  title           String
  description     String
  status          IssueStatus   @default(OPEN)
  priority        IssuePriority @default(MEDIUM)
  latitude        Float
  longitude       Float
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  createdByUserId String
  createdByUser   User          @relation(fields: [createdByUserId], references: [id])

  events          IssueEvent[]  @relation("IssueEvents")
}

model IssueEvent {
  id              String        @id @default(uuid())
  issue           Issue         @relation("IssueEvents", fields: [issueId], references: [id])
  issueId         String

  changedByUser   User          @relation("UserIssueEvents", fields: [changedByUserId], references: [id])
  changedByUserId String

  fromStatus      IssueStatus?
  toStatus        IssueStatus
  note            String?
  createdAt       DateTime      @default(now())
}


enum UserRole {
  CITIZEN
  DISPATCHER
}

enum IssueStatus {
  OPEN
  ASSIGNED
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum IssuePriority {
  LOW
  MEDIUM
  HIGH
}
